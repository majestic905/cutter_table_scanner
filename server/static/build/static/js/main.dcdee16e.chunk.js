(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{22:function(e,t,c){},23:function(e,t,c){"use strict";c.r(t);var n=c(0),a=c(1),s=c.n(a),r=c(12),i=c.n(r),l=(c(19),c(20),c(2)),o=c(3),d=c.n(o),j=c(5),b=c(13),u=function(e){var t=Object(a.useState)(!1),c=Object(l.a)(t,2),n=c[0],s=c[1],r=Object(a.useState)(void 0),i=Object(l.a)(r,2),o=i[0],u=i[1],O=Object(a.useState)(void 0),m=Object(l.a)(O,2),f=m[0],v=m[1],x=Object(a.useState)({}),h=Object(l.a)(x,2),g=h[0],p=h[1],N=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(e),s(!0),v(void 0)}),[]);return Object(a.useEffect)((function(){if(n){var t=!1;return function(){c.apply(this,arguments)}(),function(){t=!0}}function c(){return(c=Object(j.a)(d.a.mark((function c(){var n;return d.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Object(b.a)(e,g).json();case 3:if(n=c.sent,!t){c.next=6;break}return c.abrupt("return");case 6:u(n),s(!1),c.next=24;break;case 10:if(c.prev=10,c.t0=c.catch(0),!t){c.next=14;break}return c.abrupt("return");case 14:if("HTTPError"!==c.t0.name){c.next=22;break}return c.t1=v,c.next=18,c.t0.response.json();case 18:c.t2=c.sent.message,(0,c.t1)(c.t2),c.next=23;break;case 22:v(c.t0.message);case 23:s(!1);case 24:case"end":return c.stop()}}),c,null,[[0,10]])})))).apply(this,arguments)}}),[n,e,g]),[{isLoading:n,response:o,error:f},N]},O=c(6),m=c.n(O),f=c.p+"static/media/folder-24px.075add64.svg",v=function(e){var t=e.item,c=(e.createdAt,e.isSelected),a=e.doSelect,s=m()({"text-bold":c});return Object(n.jsx)("li",{children:Object(n.jsxs)("span",{className:s,onClick:a,"data-id":t.scanId,children:[Object(n.jsx)("img",{src:f,alt:"folder_icon"}),Object(n.jsxs)("span",{children:[t.createdAt," (",t.scanType[0],")"]})]})})},x=function(e){var t=e.onDelete,c=u("/api/scans"),s=Object(l.a)(c,2),r=s[0],i=r.isLoading,o=r.response,d=r.error,j=s[1],b=Object(a.useCallback)((function(){window.confirm("\u0422\u043e\u0447\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c?")&&j({method:"DELETE"})}),[t]);Object(a.useEffect)((function(){o?t():d&&alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438: ".concat(d))}),[o,d]);var O=m()("btn btn-sm btn-primary",{loading:i});return Object(n.jsx)("button",{type:"button",className:O,onClick:b,children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435"})},h=function(e){var t=e.scans,c=e.loadScans,s=e.selectedScan,r=e.selectScan,i=Object(a.useCallback)((function(e){var c=e.currentTarget.dataset.id,n=t.find((function(e){return e.scanId===c}));r(n)}),[r,t]);return t?Object(n.jsxs)("div",{className:"tree",id:"scans-list",children:[Object(n.jsx)("header",{children:Object(n.jsx)(x,{onDelete:c})}),Object(n.jsx)("hr",{}),Object(n.jsx)("ul",{children:t.map((function(e){return Object(n.jsx)(v,{item:e,isSelected:e===s,doSelect:i},e.scanId)}))})]}):null},g=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(a.useState)(e),c=Object(l.a)(t,2),n=c[0],s=c[1],r=Object(a.useCallback)((function(){return s(!0)}),[s]),i=Object(a.useCallback)((function(){return s(!1)}),[s]),o=Object(a.useCallback)((function(){return s((function(e){return!e}))}),[s]);return{openModal:r,closeModal:i,toggleModal:o,isOpened:n}},p=c(4),N=c(11),k=function(e){var t=e.text,c=e.isActive,a=e.name,s=e.onClick,r=m()("tab-item text-tiny text-bold text-uppercase",{active:c});return Object(n.jsx)("li",{className:r,"data-tab-name":a,onClick:s,children:Object(n.jsx)("a",{href:"#",children:t})})},C=function(e){var t=e.children;return Object(n.jsx)("ul",{className:"tab tab-block",children:t})},S=function(e){var t=e.filename,c=e.url,s=e.src,r=e.alt,i=Object(N.a)(e,["filename","url","src","alt"]);if(r=r||s,c=c||s,!t&&c){var l=c.split("/");t=l[l.length-1]}var o=Object(a.useCallback)((function(){fetch(c).then((function(e){return e.blob()})).then((function(e){var c=window.URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=c,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(c)})).catch((function(e){console.error(e),alert(e.message)}))}),[c,t]);return Object(n.jsx)("img",Object(p.a)({className:"img-responsive clickable c-hand",src:s,alt:r,onClick:o},i))},L=function(e){var t=e.src,c=e.alt,a=Object(N.a)(e,["src","alt"]);return c=c||t,Object(n.jsx)("img",Object(p.a)({className:"img-responsive",src:t,alt:c},a))},y=function(e){var t=e.images,c=e.isClickable?S:L,a=["LU","RU","LL","RL"].map((function(e){return Object(n.jsx)("div",{className:"column col-6",children:Object(n.jsx)(c,Object(p.a)({},t[e]))},e)}));return Object(n.jsx)("div",{className:"container grid-md",children:Object(n.jsx)("div",{className:"columns",children:a})})},T=function(e){return Object(n.jsx)("div",{className:"container grid-xs",children:Object(n.jsx)(S,Object(p.a)({},e))})},A=function(e){for(var t=e.scan,c=Object(a.useState)("result"),s=Object(l.a)(c,2),r=s[0],i=s[1],o=Object(a.useCallback)((function(e){return i(e.currentTarget.dataset.tabName)}),[i]),d={},j=0,b=["original","undistorted","projected"];j<b.length;j++){var u=b[j];d[u]={};for(var O=0,m=["LU","LL","RU","RL"];O<m.length;O++){var f=m[O],v=t.images[u][f].thumb;d[u][f]={src:v,alt:v}}}return d.result={src:t.images.result.thumb,alt:t.images.result.thumb,url:t.images.result.image,filename:"".concat(t.scanId,"_result.jpg")},Object(n.jsxs)("div",{children:[Object(n.jsxs)(C,{activeTab:r,selectTab:o,children:[Object(n.jsx)(k,{onClick:o,name:"original",text:"Original",isActive:"original"===r}),Object(n.jsx)(k,{onClick:o,name:"undistorted",text:"Undistorted",isActive:"undistorted"===r}),Object(n.jsx)(k,{onClick:o,name:"projected",text:"Projected",isActive:"projected"===r}),Object(n.jsx)(k,{onClick:o,name:"result",text:"Result",isActive:"result"===r})]}),"original"===r&&Object(n.jsx)(y,{images:d.original}),"undistorted"===r&&Object(n.jsx)(y,{images:d.undistorted}),"projected"===r&&Object(n.jsx)(y,{images:d.projected}),"result"===r&&Object(n.jsx)(T,Object(p.a)({},d.result))]})},R=function(e){for(var t=e.scan,c=Object(a.useState)("undistorted"),s=Object(l.a)(c,2),r=s[0],i=s[1],o=Object(a.useCallback)((function(e){return i(e.currentTarget.dataset.tabName)}),[i]),d={},j=0,b=["original","undistorted"];j<b.length;j++){var u=b[j];d[u]={};for(var O=0,m=["LU","LL","RU","RL"];O<m.length;O++){var f=m[O],v=t.images[u][f].thumb;d[u][f]={src:v,alt:v}}}for(var x=0,h=["LU","LL","RU","RL"];x<h.length;x++){var g=h[x];d.undistorted[g].url=t.images.undistorted[g].image}return Object(n.jsxs)("div",{children:[Object(n.jsxs)(C,{activeTab:r,selectTab:o,children:[Object(n.jsx)(k,{onClick:o,name:"original",text:"Original",isActive:"original"===r}),Object(n.jsx)(k,{onClick:o,name:"undistorted",text:"Undistorted",isActive:"undistorted"===r})]}),"original"===r&&Object(n.jsx)(y,{images:d.original}),"undistorted"===r&&Object(n.jsx)(y,{images:d.undistorted,isClickable:!0})]})};var U=function(e){var t=e.closeModal,c=Object(a.useState)(),s=Object(l.a)(c,2),r=s[0],i=s[1],o=u("/api/settings"),d=Object(l.a)(o,2),j=d[0],b=j.isLoading,O=j.response,f=j.error,v=d[1];Object(a.useEffect)(v,[v]),Object(a.useEffect)((function(){void 0===O||r?void 0!==O&&r&&t():i(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,c=function(e,t){return t instanceof Array?JSON.stringify(t):t};return JSON.stringify(e,c,t).replace(/\"\[/g,"[").replace(/\]\"/g,"]")}(O))}),[O,i,t]);var x=Object(a.useCallback)((function(e){e.preventDefault(),v({method:"POST",headers:{"Content-Type":"application/json"},body:e.target.elements.settings.value})}),[v]),h=m()("btn btn-primary float-right mr-2",{loading:b});return Object(n.jsxs)("form",{className:"modal active",id:"settings-modal",onSubmit:x,children:[Object(n.jsx)("span",{className:"modal-overlay",onClick:t}),Object(n.jsxs)("div",{className:"modal-container modal-fullheight",children:[Object(n.jsxs)("div",{className:"modal-header",children:[Object(n.jsx)("button",{type:"button",className:"btn btn-link float-right",onClick:t,children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"}),Object(n.jsx)("input",{type:"submit",className:h,value:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),Object(n.jsx)("div",{className:"modal-title h5",children:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"})]}),Object(n.jsxs)("ul",{className:"mt-0",children:[Object(n.jsx)("li",{className:"mt-0",children:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u044f table_section_size (\u043c\u0438\u043b\u043b\u0438\u043c\u0435\u0442\u0440\u044b) \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0432 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0435 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f, \u043e\u043d\u0438 \u0437\u0434\u0435\u0441\u044c \u0434\u043b\u044f \u0442\u043e\u0433\u043e \u0447\u0442\u043e\u0431\u044b \u0431\u044b\u043b\u0438."}),Object(n.jsx)("li",{className:"mt-0",children:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u044f projected_image_size (\u043f\u0438\u043a\u0441\u0435\u043b\u0438) \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f; \u0437\u0430\u0434\u0430\u044e\u0442\u0441\u044f \u0432\u0440\u0443\u0447\u043d\u0443\u044e; \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u043f\u0440\u043e\u043f\u043e\u0440\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c table_section_size!"})]}),f&&Object(n.jsx)("div",{className:"modal-header pt-0",children:Object(n.jsx)("div",{className:"toast toast-error",children:f})}),Object(n.jsxs)("div",{className:"modal-body pt-0",children:[r&&Object(n.jsx)("textarea",{name:"settings",defaultValue:r,className:"form-input"}),!r&&Object(n.jsx)("div",{className:"loading loading-lg"})]})]})]})},E=function(e){var t=e.loadScans,c=e.selectedScan,s=g(),r=s.isOpened,i=s.closeModal,o=s.openModal,d=u("/api/scans"),j=Object(l.a)(d,2),b=j[0],O=(b.isLoading,b.response),m=b.error,f=j[1],v=Object(a.useCallback)((function(e){f({method:"POST",searchParams:{type:e},timeout:5e4})}),[f]);return Object(a.useEffect)((function(){O?alert("\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e"):m&&alert("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e: ".concat(m)),(O||m)&&t()}),[O,m,t]),Object(n.jsxs)("div",{id:"scan",children:[Object(n.jsxs)("header",{children:[Object(n.jsx)("button",{className:"btn btn-sm btn-primary mr-2",onClick:function(){return v("SNAPSHOT")},children:"\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043a\u0430\u043d"}),Object(n.jsx)("button",{className:"btn btn-sm btn-primary mr-2",onClick:function(){return v("CALIBRATION")},children:"\u041a\u0430\u043b\u0438\u0431\u0440\u043e\u0432\u043a\u0430 \u0442\u043e\u0447\u0435\u043a"}),Object(n.jsx)("button",{type:"button",className:"btn btn-sm",onClick:o,children:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"})]}),Object(n.jsx)("hr",{}),"SNAPSHOT"===(null===c||void 0===c?void 0:c.scanType)&&Object(n.jsx)(A,{scan:c}),"CALIBRATION"===(null===c||void 0===c?void 0:c.scanType)&&Object(n.jsx)(R,{scan:c}),r&&Object(n.jsx)(U,{closeModal:i})]})};c(22);var w=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),c=t[0],s=t[1],r=u("/api/scans"),i=Object(l.a)(r,2),o=i[0],d=o.isLoading,j=o.response,b=o.error,O=i[1];return Object(a.useEffect)(O,[O]),Object(a.useEffect)((function(){j&&j.scans.length>0?s(j.scans[0]):b&&alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0441\u043f\u0438\u0441\u043a\u0430: ".concat(b))}),[j,b]),d&&!j?Object(n.jsx)("div",{className:"loading mt-2"}):Object(n.jsx)("main",{className:"container",children:Object(n.jsxs)("div",{className:"columns",children:[Object(n.jsx)("div",{className:"column col-3",id:"column-left",children:Object(n.jsx)(h,{scans:null===j||void 0===j?void 0:j.scans,loadScans:O,selectedScan:c,selectScan:s})}),Object(n.jsx)("div",{className:"divider-vert"}),Object(n.jsx)("div",{className:"column",id:"column-right",children:Object(n.jsx)(E,{loadScans:O,selectedScan:c})})]})})};i.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(w,{})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.dcdee16e.chunk.js.map